<html><head><meta charset="UTF-8" /><title>Oz document</title><meta content="Oz document" name="description" /><meta content="" name="keywords" /><meta content="width=device-width, initial-scale=1" name="viewport" /><link href="http://ozviz.io/oz.svg" rel="shortcut icon" type="image/x-icon" /><style>/* some style */

@font-face {
    font-family: "LatinModernRomanWOFF";
    /*src: url('https://www.albany.edu/~hammond/webfonts/lmroman12-regular.woff');*/
    src: url('http://ozviz.io/fonts/lmroman12-regular.woff');
}

body {
  padding: 30px;
  font-size: 18px;
  line-height: 1.7em;
  font-family: 'Computer Modern Concrete', serif;
}

div#app {
  margin: 0;
  padding: 0;
}

blockquote {
  font-style: italic;
  font-family: 'Computer Modern Serif', serif;
  color: #606060;
}

h1, h2, h3, h4 {
  font-family: "Computer Modern Serif", serif;
  line-height: 1.4;
}

.bright {
  font-family: "Computer Modern Bright", sans-serif;
}
.concrete {
  font-family: "Computer Modern Concrete", serif;
}
.typewriter {
  font-family: "Computer Modern Typewriter", monospace;
}
.sans {
  font-family: "Computer Modern Sans", sans-serif;
}
.sans-serif {
  font-family: 'Open Sans', sans-serif;
}
.serif {
  font-family: 'Open Sans', sans-serif;
}

/* more semantic block styles */
.fancy {
  font-family: "Computer Modern Serif", serif;
}
.plain {
  font-family: "Computer Modern Sans", sans-serif;
}

h1 {
  font-size: 3rem;
  margin-top: 40px;
  margin-bottom: 20px;
}

h2 {
  font-size: 2rem;
  margin-top: 50px;
  margin-bottom: 15px;
}

h3 {
  font-size: 1.5rem;
  margin-top: 40px;
  margin-bottom: 13px;
}

h4 {font-size: 1.25rem;}

code {
  line-height: 1.5;
  font-size: 1.0rem;
  color: #606060;
  margin-right: 4px;
  margin-left: 4px;
  font-family: "Computer Modern Typewriter", monospace;
}

pre {
  line-height: 1.5;
  font-size: 1.0rem;
  /*font-size: 1rem;*/
  color: #606060;
  font-family: "Computer Modern Typewriter", monospace;
}

a {
  color: darkblue;
}

div.vega-embed div.chart-wrapper {
  height: auto;
}

a:hover {
 cursor: pointer;
}


</style><link href="http://ozviz.io/fonts/lmroman12-regular.woff" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" /><script src="https://cdn.jsdelivr.net/npm/vega@5.17.0" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2" type="text/javascript"></script><link href="https://cdn.jsdelivr.net/gh/metasoarous/highlight.js@latest/styles/default.min.css" rel="stylesheet" type="text/css" /><script id="highlight-js-script" src="https://cdn.jsdelivr.net/gh/metasoarous/highlight.js@latest/highlight.min.js"></script><script>hljs.highlightAll();</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script></head><body><div><pre><code class="clj">(ns oz.day1
  (:require [cyrik.omni-trace.instrument :as i]
            [cyrik.omni-trace :as o]
            [cyrik.omni-trace.graph :as flame]
            [advent.day1]))</code></pre><p>Trying to build a solution for: <a href="https://adventofcode.com/2021/day/1">Advent of Code day 1</a></p><p>The problem is how many times n + 1 is higher than n in an array.</p><p>I'll use <a href="https://github.com/Cyrik/omni-trace">omni-trace</a> to help me find my mistakes  and <a href="https://github.com/metasoarous/oz">oz</a> to build this doc.</p><p>The initial numbers:</p><pre><code class="clj">(def depths [199 200 208 210 200 207 240 269260 263])</code></pre><p>A runner function thats going to be used inside reduce to count the number of times n is smaller then n+1</p><pre><code class="clj">(defn runner1 [acc val] (if (< val (second acc))
                          [(inc (first acc)) val]
                          [(first acc) val]))</code></pre><p>The actual solution function:</p><pre><code class="clj">(defn count-increases1 [input]
  (reduce runner1
          (rest input)
          [0 (first input)]))</code></pre><p>I'll just reduce over the input depths and an accumulator, that seems easy!</p><p>A run function so its easier to run the solution:</p><pre><code class="clj">(defn run1 [] (count-increases1 depths))</code></pre><p>Let's run it and see what we get:</p><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run1)]</code></pre><pre>[201 199]
</pre></div><p>That is not what I expected. Let's use omnitrace to see what happened:</p><div><pre><code class="clj">[:vega (assoc (cyrik.omni-trace/rooted-flamegraph 'advent.day1/run1) :width 1200 :height 450)]</code></pre><div><div id="viz-28fd2c20-c32a-4b5d-9aa4-6f6ca5b7abe6"><img alt="compiled vega png" src="data:image/png;base64," /></div><script type="text/javascript">vegaEmbed('#viz-28fd2c20-c32a-4b5d-9aa4-6f6ca5b7abe6', {"width":1200,"scales":[{"name":"color","type":"ordinal","domain":{"data":"tree","field":"name"},"range":{"scheme":"tableau20"}},{"name":"xscale","zero":false,"domain":{"signal":"xdom"},"range":{"signal":"xrange"}},{"name":"yscale","zero":false,"domain":{"signal":"ydom"},"range":{"signal":"yrange"}}],"title":"flame","portal-opts":[{"signal":"definition","command":"example.core/goto-definition"},{"signal":"args","command":"cyrik.omni-trace/re-run"}],"padding":30,"marks":[{"type":"rect","from":{"data":"filter-tree"},"encode":{"enter":{"tooltip":{"signal":"{name: datum.name,\n         args: datum.args,\n         throw: datum.thrown,\n         return: datum.return}"}},"update":{"x":{"scale":"xscale","field":"a0"},"x2":{"scale":"xscale","field":"a1"},"y":{"scale":"yscale","field":"r0"},"y2":{"scale":"yscale","field":"r1"},"fill":{"scale":"color","field":"name"},"stroke":{"value":"white"},"strokeWidth":{"value":0.1}},"hover":{"stroke":{"value":"red"},"strokeWidth":{"value":2},"zindex":{"value":1}}}},{"type":"text","from":{"data":"filter-tree"},"interactive":false,"encode":{"enter":{"font":{"value":"Helvetica Neue, Arial"},"align":{"value":"center"},"baseline":{"value":"middle"},"fill":{"value":"white"},"text":{"field":"name"}},"update":{"fontSize":{"signal":"size * 3.0 * (datum.a1 - datum.a0)"},"x":{"scale":"xscale","signal":"0.5 * (datum.a0 + datum.a1)"},"y":{"scale":"yscale","signal":"0.5 * (datum.r0 + datum.r1)"}}}}],"$schema":"https://vega.github.io/schema/vega/v5.json","signals":[{"name":"clicked","value":null,"on":[{"events":"click","update":"datum ? {value: datum.id, depth: datum.depth} : null","force":true}]},{"name":"clear","value":true,"on":[{"events":"mouseup[!event.item]","update":"true","force":true}]},{"name":"shift","value":false,"on":[{"events":"click","update":"event.shiftKey","force":true}]},{"name":"over","on":[{"events":"mouseover","source":"window","force":true,"update":"datum ? datum : null"}],"value":false},{"name":"key","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'a'"},"update":"over ? over : null"}]},{"name":"copy","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? over.name : null"}]},{"name":"definition","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'd'"},"update":"over ? over.meta : null"}]},{"name":"args","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? {traceid: over.id, args:over.args} : null"}]},{"name":"xdom","update":"slice(xext)","on":[{"events":{"signal":"delta"},"update":"[xcur[0] + span(xcur) * delta[0] / width, xcur[1] + span(xcur) * delta[0] / width]"},{"events":{"signal":"zoom"},"update":"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{"name":"ydom","update":"slice(yext)","on":[{"events":{"signal":"delta"},"update":"[ycur[0] + span(ycur) * delta[1] / height, ycur[1] + span(ycur) * delta[1] / height]"},{"events":{"signal":"zoom"},"update":"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]},{"name":"size","update":"clamp(20 / span(xdom), 0.01, 1000)"},{"name":"xext","update":"[0, width]"},{"name":"yext","update":"[height, 0]"},{"name":"xcur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(xdom)"}]},{"name":"ycur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(ydom)"}]},{"name":"delta","value":[0,0],"on":[{"events":[{"source":"window","type":"mousemove","consume":true,"between":[{"type":"mousedown"},{"source":"window","type":"mouseup"}]},{"type":"touchmove","consume":true,"filter":"event.touches.length === 1"}],"update":"down ? [down[0]-x(), y()-down[1]] : [0,0]"}]},{"name":"anchor","value":[0,0],"on":[{"events":"wheel","update":"[width / 2, height /2]"},{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"[width / 2, height /2]"}]},{"name":"zoom","value":1,"on":[{"events":"wheel!","force":true,"update":"pow(1.001, event.deltaY * pow(16, event.deltaMode))"},{"events":{"signal":"dist2"},"force":true,"update":"dist1 / dist2"}]},{"name":"down","value":null,"on":[{"events":"touchend","update":"null"},{"events":"mousedown, touchstart","update":"xy()"}]},{"name":"dist1","value":0,"on":[{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"pinchDistance(event)"},{"events":{"signal":"dist2"},"update":"dist2"}]},{"name":"dist2","value":0,"on":[{"events":{"type":"touchmove","consume":true,"filter":"event.touches.length===2"},"update":"pinchDistance(event)"}]},{"name":"xrange","update":"[0, width]"},{"name":"yrange","update":"[height,0]"}],"height":450,"data":[{"name":"selected","on":[{"trigger":"clear","remove":true},{"trigger":"!shift","remove":true},{"trigger":"!shift && clicked","insert":"clicked"},{"trigger":"shift && clicked","toggle":"clicked"}]},{"name":"tree","values":[{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"arglists":[["input"]],"line":22,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"count-increases1","ns":null},"parent":"67574","return":[201,199],"name":"advent.day1/count-increases1","start":1638898499204,"inner":[],"id":"67578","end":1638898499207},{"args":[[200,208,210,200,207,240,269,260,263],0],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67578","return":[201,0],"name":"advent.day1/runner1","start":1638898499205,"inner":[],"id":"67581","end":1638898499205},{"args":[],"meta":{"arglists":[[]],"line":27,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"run1","ns":null},"parent":null,"return":[201,199],"name":"advent.day1/run1","start":1638898499202,"inner":[],"id":"67574","end":1638898499207},{"args":[[201,0],199],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67578","return":[201,199],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67589","end":1638898499207}],"transform":[{"type":"stratify","key":"id","parentKey":"parent"}]},{"name":"tree-ancestors","source":"tree","transform":[{"type":"formula","expr":"treeAncestors('tree', datum.id, 'root')","as":"treeAncestors"}]},{"name":"tree-ancestors-flatt","source":"tree-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"selected-ancestors","source":"tree-ancestors","transform":[{"type":"filter","expr":"indata('selected', 'value', datum.id)"}]},{"name":"selected-ancestors-flat","source":"selected-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"filtered","source":"tree-ancestors-flatt","transform":[{"type":"filter","expr":"!length(data('selected')) || datum.parent == null || indata('selected', 'value', datum.treeAncestors.id)"}]},{"name":"filtered-aggregate","source":"filtered","transform":[{"type":"aggregate","groupby":["id"]}]},{"name":"filtered-tree","source":"tree","transform":[{"type":"filter","expr":"!length(data('selected'))|| indata('filtered-aggregate', 'id', datum.id) || indata('selected-ancestors-flat', 'treeAncestors.id', datum.id)"}]},{"name":"filter-tree","source":"filtered-tree","transform":[{"key":"id","parentKey":"parent","type":"stratify"},{"as":["a0","r0","a1","r1","depth","children"],"type":"partition","size":[{"signal":"width"},{"signal":"height"}],"padding":2,"sort":{"field":"id"}}]}]}, {"mode":"vega"});</script></div></div><p>Oh, I see, when hovering over the calls in the flamegraph it's easy to see that  reduce was called with the args switched.</p><p>Let's redefine it:</p><pre><code class="clj">(defn count-increases2 [input]
  (reduce runner1
          [0 (first input)
           (rest input)]))
(defn run2 [] (count-increases2 depths))</code></pre><p>And run it again:</p><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run2)]</code></pre><pre>{:via
 [{:type java.lang.IllegalArgumentException,
   :message "Don't know how to create ISeq from: java.lang.Long",
   :at [clojure.lang.RT seqFrom "RT.java" 557]}],
 :trace
 [[clojure.lang.RT seqFrom "RT.java" 557]
  [clojure.lang.RT seq "RT.java" 537]
  [clojure.lang.RT next "RT.java" 714]
  [clojure.core$next__5403 invokeStatic "core.clj" 64]
  [clojure.core$second__5409 invokeStatic "core.clj" 98]
  [clojure.core$second__5409 invoke "core.clj" 98]
  [advent.day1$runner1 invokeStatic "day1.clj" 18]
  [advent.day1$runner1 invoke "day1.clj" 18]
  [clojure.lang.AFn applyToHelper "AFn.java" 156]
  [clojure.lang.AFn applyTo "AFn.java" 144]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.instrument$trace_fn_call$fn__17843
   invoke
   "instrument.cljc"
   51]
  [cyrik.omni_trace.instrument$trace_fn_call
   invokeStatic
   "instrument.cljc"
   49]
  [cyrik.omni_trace.instrument$trace_fn_call
   invoke
   "instrument.cljc"
   40]
  [cyrik.omni_trace.instrument$instrumented$instrumented__17851
   invoke
   "instrument.cljc"
   92]
  [clojure.lang.PersistentVector reduce "PersistentVector.java" 329]
  [clojure.core$reduce invokeStatic "core.clj" 6825]
  [clojure.core$reduce invoke "core.clj" 6812]
  [advent.day1$count_increases2 invokeStatic "day1.clj" 36]
  [advent.day1$count_increases2 invoke "day1.clj" 35]
  [clojure.lang.AFn applyToHelper "AFn.java" 154]
  [clojure.lang.AFn applyTo "AFn.java" 144]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.instrument$trace_fn_call$fn__17843
   invoke
   "instrument.cljc"
   51]
  [cyrik.omni_trace.instrument$trace_fn_call
   invokeStatic
   "instrument.cljc"
   49]
  [cyrik.omni_trace.instrument$trace_fn_call
   invoke
   "instrument.cljc"
   40]
  [cyrik.omni_trace.instrument$instrumented$instrumented__17851
   invoke
   "instrument.cljc"
   90]
  [advent.day1$run2 invokeStatic "day1.clj" 39]
  [advent.day1$run2 invoke "day1.clj" 39]
  [clojure.lang.AFn applyToHelper "AFn.java" 152]
  [clojure.lang.AFn applyTo "AFn.java" 144]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.instrument$trace_fn_call$fn__17843
   invoke
   "instrument.cljc"
   51]
  [cyrik.omni_trace.instrument$trace_fn_call
   invokeStatic
   "instrument.cljc"
   49]
  [cyrik.omni_trace.instrument$trace_fn_call
   invoke
   "instrument.cljc"
   40]
  [cyrik.omni_trace.instrument$instrumented$instrumented__17851
   invoke
   "instrument.cljc"
   88]
  [clojure.lang.AFn applyToHelper "AFn.java" 152]
  [clojure.lang.RestFn applyTo "RestFn.java" 132]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.deep_trace$run_traced$fn__18188
   invoke
   "deep_trace.clj"
   72]
  [cyrik.omni_trace.deep_trace$run_traced
   invokeStatic
   "deep_trace.clj"
   72]
  [cyrik.omni_trace.deep_trace$run_traced doInvoke "deep_trace.clj" 66]
  [clojure.lang.RestFn invoke "RestFn.java" 410]
  [clojure.lang.AFn applyToHelper "AFn.java" 154]
  [clojure.lang.RestFn applyTo "RestFn.java" 132]
  [clojure.lang.Var applyTo "Var.java" 705]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace$run_traced invokeStatic "omni_trace.cljc" 67]
  [cyrik.omni_trace$run_traced doInvoke "omni_trace.cljc" 66]
  [clojure.lang.RestFn invoke "RestFn.java" 410]
  [oz.day1$eval66922 invokeStatic "NO_SOURCE_FILE" 15]
  [oz.day1$eval66922 invoke "NO_SOURCE_FILE" 15]
  [clojure.lang.Compiler eval "Compiler.java" 7181]
  [clojure.lang.Compiler eval "Compiler.java" 7136]
  [clojure.core$eval invokeStatic "core.clj" 3202]
  [clojure.core$eval invoke "core.clj" 3198]
  [oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417
   invoke
   "next.clj"
   899]
  [oz.next$evaluate_block_BANG_$fn__65402$fn__65416
   invoke
   "next.clj"
   898]
  [oz.next$evaluate_block_BANG_$fn__65402 invoke "next.clj" 897]
  [clojure.core.async$thread_call$fn__45672 invoke "async.clj" 484]
  [clojure.lang.AFn run "AFn.java" 22]
  [java.util.concurrent.ThreadPoolExecutor
   runWorker
   "ThreadPoolExecutor.java"
   1136]
  [java.util.concurrent.ThreadPoolExecutor$Worker
   run
   "ThreadPoolExecutor.java"
   635]
  [java.lang.Thread run "Thread.java" 833]],
 :cause "Don't know how to create ISeq from: java.lang.Long"}
</pre></div><p>Wow, it  blows up? I guess I'll try to see why.</p><div><pre><code class="clj">[:vega (assoc (cyrik.omni-trace/rooted-flamegraph 'advent.day1/run2) :width 1200 :height 500)]</code></pre><div><div id="viz-8c4fb359-3120-41e5-81e2-70246cb11544"><img alt="compiled vega png" src="data:image/png;base64," /></div><script type="text/javascript">vegaEmbed('#viz-8c4fb359-3120-41e5-81e2-70246cb11544', {"width":1200,"scales":[{"name":"color","type":"ordinal","domain":{"data":"tree","field":"name"},"range":{"scheme":"tableau20"}},{"name":"xscale","zero":false,"domain":{"signal":"xdom"},"range":{"signal":"xrange"}},{"name":"yscale","zero":false,"domain":{"signal":"ydom"},"range":{"signal":"yrange"}}],"title":"flame","portal-opts":[{"signal":"definition","command":"example.core/goto-definition"},{"signal":"args","command":"cyrik.omni-trace/re-run"}],"padding":30,"marks":[{"type":"rect","from":{"data":"filter-tree"},"encode":{"enter":{"tooltip":{"signal":"{name: datum.name,\n         args: datum.args,\n         throw: datum.thrown,\n         return: datum.return}"}},"update":{"x":{"scale":"xscale","field":"a0"},"x2":{"scale":"xscale","field":"a1"},"y":{"scale":"yscale","field":"r0"},"y2":{"scale":"yscale","field":"r1"},"fill":{"scale":"color","field":"name"},"stroke":{"value":"white"},"strokeWidth":{"value":0.1}},"hover":{"stroke":{"value":"red"},"strokeWidth":{"value":2},"zindex":{"value":1}}}},{"type":"text","from":{"data":"filter-tree"},"interactive":false,"encode":{"enter":{"font":{"value":"Helvetica Neue, Arial"},"align":{"value":"center"},"baseline":{"value":"middle"},"fill":{"value":"white"},"text":{"field":"name"}},"update":{"fontSize":{"signal":"size * 3.0 * (datum.a1 - datum.a0)"},"x":{"scale":"xscale","signal":"0.5 * (datum.a0 + datum.a1)"},"y":{"scale":"yscale","signal":"0.5 * (datum.r0 + datum.r1)"}}}}],"$schema":"https://vega.github.io/schema/vega/v5.json","signals":[{"name":"clicked","value":null,"on":[{"events":"click","update":"datum ? {value: datum.id, depth: datum.depth} : null","force":true}]},{"name":"clear","value":true,"on":[{"events":"mouseup[!event.item]","update":"true","force":true}]},{"name":"shift","value":false,"on":[{"events":"click","update":"event.shiftKey","force":true}]},{"name":"over","on":[{"events":"mouseover","source":"window","force":true,"update":"datum ? datum : null"}],"value":false},{"name":"key","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'a'"},"update":"over ? over : null"}]},{"name":"copy","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? over.name : null"}]},{"name":"definition","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'd'"},"update":"over ? over.meta : null"}]},{"name":"args","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? {traceid: over.id, args:over.args} : null"}]},{"name":"xdom","update":"slice(xext)","on":[{"events":{"signal":"delta"},"update":"[xcur[0] + span(xcur) * delta[0] / width, xcur[1] + span(xcur) * delta[0] / width]"},{"events":{"signal":"zoom"},"update":"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{"name":"ydom","update":"slice(yext)","on":[{"events":{"signal":"delta"},"update":"[ycur[0] + span(ycur) * delta[1] / height, ycur[1] + span(ycur) * delta[1] / height]"},{"events":{"signal":"zoom"},"update":"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]},{"name":"size","update":"clamp(20 / span(xdom), 0.01, 1000)"},{"name":"xext","update":"[0, width]"},{"name":"yext","update":"[height, 0]"},{"name":"xcur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(xdom)"}]},{"name":"ycur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(ydom)"}]},{"name":"delta","value":[0,0],"on":[{"events":[{"source":"window","type":"mousemove","consume":true,"between":[{"type":"mousedown"},{"source":"window","type":"mouseup"}]},{"type":"touchmove","consume":true,"filter":"event.touches.length === 1"}],"update":"down ? [down[0]-x(), y()-down[1]] : [0,0]"}]},{"name":"anchor","value":[0,0],"on":[{"events":"wheel","update":"[width / 2, height /2]"},{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"[width / 2, height /2]"}]},{"name":"zoom","value":1,"on":[{"events":"wheel!","force":true,"update":"pow(1.001, event.deltaY * pow(16, event.deltaMode))"},{"events":{"signal":"dist2"},"force":true,"update":"dist1 / dist2"}]},{"name":"down","value":null,"on":[{"events":"touchend","update":"null"},{"events":"mousedown, touchstart","update":"xy()"}]},{"name":"dist1","value":0,"on":[{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"pinchDistance(event)"},{"events":{"signal":"dist2"},"update":"dist2"}]},{"name":"dist2","value":0,"on":[{"events":{"type":"touchmove","consume":true,"filter":"event.touches.length===2"},"update":"pinchDistance(event)"}]},{"name":"xrange","update":"[0, width]"},{"name":"yrange","update":"[height,0]"}],"height":500,"data":[{"name":"selected","on":[{"trigger":"clear","remove":true},{"trigger":"!shift","remove":true},{"trigger":"!shift && clicked","insert":"clicked"},{"trigger":"shift && clicked","toggle":"clicked"}]},{"name":"tree","values":[{"args":[],"meta":{"arglists":[[]],"line":39,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"run2","ns":null},"parent":null,"name":"advent.day1/run2","start":1638898499201,"inner":[],"id":"67573","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":[["clojure.lang.RT","seqFrom","RT.java",557],["clojure.lang.RT","seq","RT.java",537],["clojure.lang.RT","next","RT.java",714],["clojure.core$next__5403","invokeStatic","core.clj",64],["clojure.core$second__5409","invokeStatic","core.clj",98],["clojure.core$second__5409","invoke","core.clj",98],["advent.day1$runner1","invokeStatic","day1.clj",18],["advent.day1$runner1","invoke","day1.clj",18],["clojure.lang.AFn","applyToHelper","AFn.java",156],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",92],["clojure.lang.PersistentVector","reduce","PersistentVector.java",329],["clojure.core$reduce","invokeStatic","core.clj",6825],["clojure.core$reduce","invoke","core.clj",6812],["advent.day1$count_increases2","invokeStatic","day1.clj",36],["advent.day1$count_increases2","invoke","day1.clj",35],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",90],["advent.day1$run2","invokeStatic","day1.clj",39],["advent.day1$run2","invoke","day1.clj",39],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",88],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.deep_trace$run_traced$fn__18188","invoke","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","invokeStatic","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","doInvoke","deep_trace.clj",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.lang.Var","applyTo","Var.java",705],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace$run_traced","invokeStatic","omni_trace.cljc",67],["cyrik.omni_trace$run_traced","doInvoke","omni_trace.cljc",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["oz.day1$eval66922","invokeStatic","NO_SOURCE_FILE",15],["oz.day1$eval66922","invoke","NO_SOURCE_FILE",15],["clojure.lang.Compiler","eval","Compiler.java",7181],["clojure.lang.Compiler","eval","Compiler.java",7136],["clojure.core$eval","invokeStatic","core.clj",3202],["clojure.core$eval","invoke","core.clj",3198],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417","invoke","next.clj",899],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416","invoke","next.clj",898],["oz.next$evaluate_block_BANG_$fn__65402","invoke","next.clj",897],["clojure.core.async$thread_call$fn__45672","invoke","async.clj",484],["clojure.lang.AFn","run","AFn.java",22],["java.util.concurrent.ThreadPoolExecutor","runWorker","ThreadPoolExecutor.java",1136],["java.util.concurrent.ThreadPoolExecutor$Worker","run","ThreadPoolExecutor.java",635],["java.lang.Thread","run","Thread.java",833]],"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638898499208},{"args":[0,199],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67577","name":"advent.day1/runner1","start":1638898499204,"inner":[],"id":"67579","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":[["clojure.lang.RT","seqFrom","RT.java",557],["clojure.lang.RT","seq","RT.java",537],["clojure.lang.RT","next","RT.java",714],["clojure.core$next__5403","invokeStatic","core.clj",64],["clojure.core$second__5409","invokeStatic","core.clj",98],["clojure.core$second__5409","invoke","core.clj",98],["advent.day1$runner1","invokeStatic","day1.clj",18],["advent.day1$runner1","invoke","day1.clj",18],["clojure.lang.AFn","applyToHelper","AFn.java",156],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",92],["clojure.lang.PersistentVector","reduce","PersistentVector.java",329],["clojure.core$reduce","invokeStatic","core.clj",6825],["clojure.core$reduce","invoke","core.clj",6812],["advent.day1$count_increases2","invokeStatic","day1.clj",36],["advent.day1$count_increases2","invoke","day1.clj",35],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",90],["advent.day1$run2","invokeStatic","day1.clj",39],["advent.day1$run2","invoke","day1.clj",39],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",88],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.deep_trace$run_traced$fn__18188","invoke","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","invokeStatic","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","doInvoke","deep_trace.clj",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.lang.Var","applyTo","Var.java",705],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace$run_traced","invokeStatic","omni_trace.cljc",67],["cyrik.omni_trace$run_traced","doInvoke","omni_trace.cljc",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["oz.day1$eval66922","invokeStatic","NO_SOURCE_FILE",15],["oz.day1$eval66922","invoke","NO_SOURCE_FILE",15],["clojure.lang.Compiler","eval","Compiler.java",7181],["clojure.lang.Compiler","eval","Compiler.java",7136],["clojure.core$eval","invokeStatic","core.clj",3202],["clojure.core$eval","invoke","core.clj",3198],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417","invoke","next.clj",899],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416","invoke","next.clj",898],["oz.next$evaluate_block_BANG_$fn__65402","invoke","next.clj",897],["clojure.core.async$thread_call$fn__45672","invoke","async.clj",484],["clojure.lang.AFn","run","AFn.java",22],["java.util.concurrent.ThreadPoolExecutor","runWorker","ThreadPoolExecutor.java",1136],["java.util.concurrent.ThreadPoolExecutor$Worker","run","ThreadPoolExecutor.java",635],["java.lang.Thread","run","Thread.java",833]],"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638898499207},{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"arglists":[["input"]],"line":35,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"count-increases2","ns":null},"parent":"67573","name":"advent.day1/count-increases2","start":1638898499204,"inner":[],"id":"67577","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":[["clojure.lang.RT","seqFrom","RT.java",557],["clojure.lang.RT","seq","RT.java",537],["clojure.lang.RT","next","RT.java",714],["clojure.core$next__5403","invokeStatic","core.clj",64],["clojure.core$second__5409","invokeStatic","core.clj",98],["clojure.core$second__5409","invoke","core.clj",98],["advent.day1$runner1","invokeStatic","day1.clj",18],["advent.day1$runner1","invoke","day1.clj",18],["clojure.lang.AFn","applyToHelper","AFn.java",156],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",92],["clojure.lang.PersistentVector","reduce","PersistentVector.java",329],["clojure.core$reduce","invokeStatic","core.clj",6825],["clojure.core$reduce","invoke","core.clj",6812],["advent.day1$count_increases2","invokeStatic","day1.clj",36],["advent.day1$count_increases2","invoke","day1.clj",35],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",90],["advent.day1$run2","invokeStatic","day1.clj",39],["advent.day1$run2","invoke","day1.clj",39],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",88],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.deep_trace$run_traced$fn__18188","invoke","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","invokeStatic","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","doInvoke","deep_trace.clj",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.lang.Var","applyTo","Var.java",705],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace$run_traced","invokeStatic","omni_trace.cljc",67],["cyrik.omni_trace$run_traced","doInvoke","omni_trace.cljc",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["oz.day1$eval66922","invokeStatic","NO_SOURCE_FILE",15],["oz.day1$eval66922","invoke","NO_SOURCE_FILE",15],["clojure.lang.Compiler","eval","Compiler.java",7181],["clojure.lang.Compiler","eval","Compiler.java",7136],["clojure.core$eval","invokeStatic","core.clj",3202],["clojure.core$eval","invoke","core.clj",3198],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417","invoke","next.clj",899],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416","invoke","next.clj",898],["oz.next$evaluate_block_BANG_$fn__65402","invoke","next.clj",897],["clojure.core.async$thread_call$fn__45672","invoke","async.clj",484],["clojure.lang.AFn","run","AFn.java",22],["java.util.concurrent.ThreadPoolExecutor","runWorker","ThreadPoolExecutor.java",1136],["java.util.concurrent.ThreadPoolExecutor$Worker","run","ThreadPoolExecutor.java",635],["java.lang.Thread","run","Thread.java",833]],"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638898499208}],"transform":[{"type":"stratify","key":"id","parentKey":"parent"}]},{"name":"tree-ancestors","source":"tree","transform":[{"type":"formula","expr":"treeAncestors('tree', datum.id, 'root')","as":"treeAncestors"}]},{"name":"tree-ancestors-flatt","source":"tree-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"selected-ancestors","source":"tree-ancestors","transform":[{"type":"filter","expr":"indata('selected', 'value', datum.id)"}]},{"name":"selected-ancestors-flat","source":"selected-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"filtered","source":"tree-ancestors-flatt","transform":[{"type":"filter","expr":"!length(data('selected')) || datum.parent == null || indata('selected', 'value', datum.treeAncestors.id)"}]},{"name":"filtered-aggregate","source":"filtered","transform":[{"type":"aggregate","groupby":["id"]}]},{"name":"filtered-tree","source":"tree","transform":[{"type":"filter","expr":"!length(data('selected'))|| indata('filtered-aggregate', 'id', datum.id) || indata('selected-ancestors-flat', 'treeAncestors.id', datum.id)"}]},{"name":"filter-tree","source":"filtered-tree","transform":[{"key":"id","parentKey":"parent","type":"stratify"},{"as":["a0","r0","a1","r1","depth","children"],"type":"partition","size":[{"signal":"width"},{"signal":"height"}],"padding":2,"sort":{"field":"id"}}]}]}, {"mode":"vega"});</script></div></div><p>It seems we accidentally put the collection into the starting argument! Let's fix that.</p><pre><code class="clj">(defn count-increases3 [input]
  (reduce runner1
          [0 (first input)]
          (rest input)))
(defn run3 [] (count-increases3 depths))</code></pre><p>And run it again</p><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run3)]</code></pre><pre>[2 263]
</pre></div><p>Wrong again? This is starting to be embarrassing...</p><div><pre><code class="clj">[:vega (assoc (cyrik.omni-trace/rooted-flamegraph 'advent.day1/run3) :width 1200 :height 500)]</code></pre><div><div id="viz-5587647d-e44f-4734-a876-0f548853ea8f"><img alt="compiled vega png" src="data:image/png;base64," /></div><script type="text/javascript">vegaEmbed('#viz-5587647d-e44f-4734-a876-0f548853ea8f', {"width":1200,"scales":[{"name":"color","type":"ordinal","domain":{"data":"tree","field":"name"},"range":{"scheme":"tableau20"}},{"name":"xscale","zero":false,"domain":{"signal":"xdom"},"range":{"signal":"xrange"}},{"name":"yscale","zero":false,"domain":{"signal":"ydom"},"range":{"signal":"yrange"}}],"title":"flame","portal-opts":[{"signal":"definition","command":"example.core/goto-definition"},{"signal":"args","command":"cyrik.omni-trace/re-run"}],"padding":30,"marks":[{"type":"rect","from":{"data":"filter-tree"},"encode":{"enter":{"tooltip":{"signal":"{name: datum.name,\n         args: datum.args,\n         throw: datum.thrown,\n         return: datum.return}"}},"update":{"x":{"scale":"xscale","field":"a0"},"x2":{"scale":"xscale","field":"a1"},"y":{"scale":"yscale","field":"r0"},"y2":{"scale":"yscale","field":"r1"},"fill":{"scale":"color","field":"name"},"stroke":{"value":"white"},"strokeWidth":{"value":0.1}},"hover":{"stroke":{"value":"red"},"strokeWidth":{"value":2},"zindex":{"value":1}}}},{"type":"text","from":{"data":"filter-tree"},"interactive":false,"encode":{"enter":{"font":{"value":"Helvetica Neue, Arial"},"align":{"value":"center"},"baseline":{"value":"middle"},"fill":{"value":"white"},"text":{"field":"name"}},"update":{"fontSize":{"signal":"size * 3.0 * (datum.a1 - datum.a0)"},"x":{"scale":"xscale","signal":"0.5 * (datum.a0 + datum.a1)"},"y":{"scale":"yscale","signal":"0.5 * (datum.r0 + datum.r1)"}}}}],"$schema":"https://vega.github.io/schema/vega/v5.json","signals":[{"name":"clicked","value":null,"on":[{"events":"click","update":"datum ? {value: datum.id, depth: datum.depth} : null","force":true}]},{"name":"clear","value":true,"on":[{"events":"mouseup[!event.item]","update":"true","force":true}]},{"name":"shift","value":false,"on":[{"events":"click","update":"event.shiftKey","force":true}]},{"name":"over","on":[{"events":"mouseover","source":"window","force":true,"update":"datum ? datum : null"}],"value":false},{"name":"key","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'a'"},"update":"over ? over : null"}]},{"name":"copy","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? over.name : null"}]},{"name":"definition","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'd'"},"update":"over ? over.meta : null"}]},{"name":"args","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? {traceid: over.id, args:over.args} : null"}]},{"name":"xdom","update":"slice(xext)","on":[{"events":{"signal":"delta"},"update":"[xcur[0] + span(xcur) * delta[0] / width, xcur[1] + span(xcur) * delta[0] / width]"},{"events":{"signal":"zoom"},"update":"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{"name":"ydom","update":"slice(yext)","on":[{"events":{"signal":"delta"},"update":"[ycur[0] + span(ycur) * delta[1] / height, ycur[1] + span(ycur) * delta[1] / height]"},{"events":{"signal":"zoom"},"update":"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]},{"name":"size","update":"clamp(20 / span(xdom), 0.01, 1000)"},{"name":"xext","update":"[0, width]"},{"name":"yext","update":"[height, 0]"},{"name":"xcur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(xdom)"}]},{"name":"ycur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(ydom)"}]},{"name":"delta","value":[0,0],"on":[{"events":[{"source":"window","type":"mousemove","consume":true,"between":[{"type":"mousedown"},{"source":"window","type":"mouseup"}]},{"type":"touchmove","consume":true,"filter":"event.touches.length === 1"}],"update":"down ? [down[0]-x(), y()-down[1]] : [0,0]"}]},{"name":"anchor","value":[0,0],"on":[{"events":"wheel","update":"[width / 2, height /2]"},{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"[width / 2, height /2]"}]},{"name":"zoom","value":1,"on":[{"events":"wheel!","force":true,"update":"pow(1.001, event.deltaY * pow(16, event.deltaMode))"},{"events":{"signal":"dist2"},"force":true,"update":"dist1 / dist2"}]},{"name":"down","value":null,"on":[{"events":"touchend","update":"null"},{"events":"mousedown, touchstart","update":"xy()"}]},{"name":"dist1","value":0,"on":[{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"pinchDistance(event)"},{"events":{"signal":"dist2"},"update":"dist2"}]},{"name":"dist2","value":0,"on":[{"events":{"type":"touchmove","consume":true,"filter":"event.touches.length===2"},"update":"pinchDistance(event)"}]},{"name":"xrange","update":"[0, width]"},{"name":"yrange","update":"[height,0]"}],"height":500,"data":[{"name":"selected","on":[{"trigger":"clear","remove":true},{"trigger":"!shift","remove":true},{"trigger":"!shift && clicked","insert":"clicked"},{"trigger":"shift && clicked","toggle":"clicked"}]},{"name":"tree","values":[{"args":[[1,207],240],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[1,240],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67586","end":1638898499207},{"args":[[1,240],269],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[1,269],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67587","end":1638898499207},{"args":[[0,208],210],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[0,210],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67583","end":1638898499207},{"args":[[2,260],263],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[2,263],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67590","end":1638898499207},{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"arglists":[["input"]],"line":48,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"count-increases3","ns":null},"parent":"67575","return":[2,263],"name":"advent.day1/count-increases3","start":1638898499204,"inner":[],"id":"67576","end":1638898499207},{"args":[[1,269],260],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[2,260],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67588","end":1638898499207},{"args":[],"meta":{"arglists":[[]],"line":52,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"run3","ns":null},"parent":null,"return":[2,263],"name":"advent.day1/run3","start":1638898499202,"inner":[],"id":"67575","end":1638898499207},{"args":[[0,210],200],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[1,200],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67584","end":1638898499207},{"args":[[0,200],208],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[0,208],"name":"advent.day1/runner1","start":1638898499206,"inner":[],"id":"67582","end":1638898499206},{"args":[[0,199],200],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[0,200],"name":"advent.day1/runner1","start":1638898499204,"inner":[],"id":"67580","end":1638898499204},{"args":[[1,200],207],"meta":{"arglists":[["acc","val"]],"line":18,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner1","ns":null},"parent":"67576","return":[1,207],"name":"advent.day1/runner1","start":1638898499207,"inner":[],"id":"67585","end":1638898499207}],"transform":[{"type":"stratify","key":"id","parentKey":"parent"}]},{"name":"tree-ancestors","source":"tree","transform":[{"type":"formula","expr":"treeAncestors('tree', datum.id, 'root')","as":"treeAncestors"}]},{"name":"tree-ancestors-flatt","source":"tree-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"selected-ancestors","source":"tree-ancestors","transform":[{"type":"filter","expr":"indata('selected', 'value', datum.id)"}]},{"name":"selected-ancestors-flat","source":"selected-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"filtered","source":"tree-ancestors-flatt","transform":[{"type":"filter","expr":"!length(data('selected')) || datum.parent == null || indata('selected', 'value', datum.treeAncestors.id)"}]},{"name":"filtered-aggregate","source":"filtered","transform":[{"type":"aggregate","groupby":["id"]}]},{"name":"filtered-tree","source":"tree","transform":[{"type":"filter","expr":"!length(data('selected'))|| indata('filtered-aggregate', 'id', datum.id) || indata('selected-ancestors-flat', 'treeAncestors.id', datum.id)"}]},{"name":"filter-tree","source":"filtered-tree","transform":[{"key":"id","parentKey":"parent","type":"stratify"},{"as":["a0","r0","a1","r1","depth","children"],"type":"partition","size":[{"signal":"width"},{"signal":"height"}],"padding":2,"sort":{"field":"id"}}]}]}, {"mode":"vega"});</script></div></div><p>It seems runner is only returning increased counts when the first arg is larger than the second.</p><p>I mixed up our prefix less then again ... let's fix it and run:</p><pre><code class="clj">(defn runner2 [acc val] (if (< (second acc) val)
                          [(inc (first acc)) val]
                          [(first acc) val]))</code></pre><pre><code class="clj">(defn count-increases4 [input]
  (reduce runner2
          [0 (first input)]
          (rest input)))</code></pre><pre><code class="clj">(defn run4 [] (count-increases4 depths))</code></pre><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run4)]</code></pre><pre>[7 263]
</pre></div><p>Puh finally correct! </p><p>Let's try to do the advanced version as well!</p><p>This time I need to check a window of 3 numbers against the window moved up by one. That's the same thing right?</p><p>Let's see if we can use the same solution just interleaving the depths while dropping one every time:</p><div><pre><code class="clj">[:pprint (interleave (range 10) (drop 1 (range 10)) (drop 2 (range 10)))]</code></pre><pre>(0 1 2 1 2 3 2 3 4 3 4 5 4 5 6 5 6 7 6 7 8 7 8 9)
</pre></div><p>Put it in:</p><pre><code class="clj">(defn runner3 [acc val] (if (< (apply + (second acc)) (apply + val))
                          [(inc (first acc)) val]
                          [(first acc) val]))</code></pre><pre><code class="clj">(defn count-increases5 [input]
  (reduce runner3
          (rest (interleave input (drop 1 input) (drop 2 input)))
          [0 (first (interleave input (drop 1 input) (drop 2 input)))]))</code></pre><pre><code class="clj">(defn run5 [] (count-increases5 depths))</code></pre><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run5)]</code></pre><pre>{:via
 [{:type java.lang.IllegalArgumentException,
   :message "Don't know how to create ISeq from: java.lang.Long",
   :at [clojure.lang.RT seqFrom "RT.java" 557]}],
 :trace
 [[clojure.lang.RT seqFrom "RT.java" 557]
  [clojure.lang.RT seq "RT.java" 537]
  [clojure.core$seq__5419 invokeStatic "core.clj" 139]
  [clojure.core$apply invokeStatic "core.clj" 662]
  [clojure.core$apply invoke "core.clj" 662]
  [advent.day1$runner3 invokeStatic "day1.clj" 74]
  [advent.day1$runner3 invoke "day1.clj" 74]
  [clojure.lang.AFn applyToHelper "AFn.java" 156]
  [clojure.lang.AFn applyTo "AFn.java" 144]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.instrument$trace_fn_call$fn__17843
   invoke
   "instrument.cljc"
   51]
  [cyrik.omni_trace.instrument$trace_fn_call
   invokeStatic
   "instrument.cljc"
   49]
  [cyrik.omni_trace.instrument$trace_fn_call
   invoke
   "instrument.cljc"
   40]
  [cyrik.omni_trace.instrument$instrumented$instrumented__17851
   invoke
   "instrument.cljc"
   92]
  [clojure.lang.PersistentVector reduce "PersistentVector.java" 343]
  [clojure.core$reduce invokeStatic "core.clj" 6829]
  [clojure.core$reduce invoke "core.clj" 6812]
  [advent.day1$count_increases5 invokeStatic "day1.clj" 79]
  [advent.day1$count_increases5 invoke "day1.clj" 78]
  [clojure.lang.AFn applyToHelper "AFn.java" 154]
  [clojure.lang.AFn applyTo "AFn.java" 144]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.instrument$trace_fn_call$fn__17843
   invoke
   "instrument.cljc"
   51]
  [cyrik.omni_trace.instrument$trace_fn_call
   invokeStatic
   "instrument.cljc"
   49]
  [cyrik.omni_trace.instrument$trace_fn_call
   invoke
   "instrument.cljc"
   40]
  [cyrik.omni_trace.instrument$instrumented$instrumented__17851
   invoke
   "instrument.cljc"
   90]
  [advent.day1$run5 invokeStatic "day1.clj" 83]
  [advent.day1$run5 invoke "day1.clj" 83]
  [clojure.lang.AFn applyToHelper "AFn.java" 152]
  [clojure.lang.AFn applyTo "AFn.java" 144]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.instrument$trace_fn_call$fn__17843
   invoke
   "instrument.cljc"
   51]
  [cyrik.omni_trace.instrument$trace_fn_call
   invokeStatic
   "instrument.cljc"
   49]
  [cyrik.omni_trace.instrument$trace_fn_call
   invoke
   "instrument.cljc"
   40]
  [cyrik.omni_trace.instrument$instrumented$instrumented__17851
   invoke
   "instrument.cljc"
   88]
  [clojure.lang.AFn applyToHelper "AFn.java" 152]
  [clojure.lang.RestFn applyTo "RestFn.java" 132]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace.deep_trace$run_traced$fn__18188
   invoke
   "deep_trace.clj"
   72]
  [cyrik.omni_trace.deep_trace$run_traced
   invokeStatic
   "deep_trace.clj"
   72]
  [cyrik.omni_trace.deep_trace$run_traced doInvoke "deep_trace.clj" 66]
  [clojure.lang.RestFn invoke "RestFn.java" 410]
  [clojure.lang.AFn applyToHelper "AFn.java" 154]
  [clojure.lang.RestFn applyTo "RestFn.java" 132]
  [clojure.lang.Var applyTo "Var.java" 705]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace$run_traced invokeStatic "omni_trace.cljc" 67]
  [cyrik.omni_trace$run_traced doInvoke "omni_trace.cljc" 66]
  [clojure.lang.RestFn invoke "RestFn.java" 410]
  [oz.day1$eval68071 invokeStatic "NO_SOURCE_FILE" 0]
  [oz.day1$eval68071 invoke "NO_SOURCE_FILE" -1]
  [clojure.lang.Compiler eval "Compiler.java" 7181]
  [clojure.lang.Compiler eval "Compiler.java" 7136]
  [clojure.core$eval invokeStatic "core.clj" 3202]
  [clojure.core$eval invoke "core.clj" 3198]
  [oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417
   invoke
   "next.clj"
   899]
  [oz.next$evaluate_block_BANG_$fn__65402$fn__65416
   invoke
   "next.clj"
   898]
  [oz.next$evaluate_block_BANG_$fn__65402 invoke "next.clj" 897]
  [clojure.core.async$thread_call$fn__45672 invoke "async.clj" 484]
  [clojure.lang.AFn run "AFn.java" 22]
  [java.util.concurrent.ThreadPoolExecutor
   runWorker
   "ThreadPoolExecutor.java"
   1136]
  [java.util.concurrent.ThreadPoolExecutor$Worker
   run
   "ThreadPoolExecutor.java"
   635]
  [java.lang.Thread run "Thread.java" 833]],
 :cause "Don't know how to create ISeq from: java.lang.Long"}
</pre></div><p>exception again?</p><div><pre><code class="clj">[:vega (assoc (cyrik.omni-trace/rooted-flamegraph 'advent.day1/run5) :width 1200 :height 500)]</code></pre><div><div id="viz-a87a8d3d-96a5-4159-a66e-929472f9c6a6"><img alt="compiled vega png" src="data:image/png;base64," /></div><script type="text/javascript">vegaEmbed('#viz-a87a8d3d-96a5-4159-a66e-929472f9c6a6', {"width":1200,"scales":[{"name":"color","type":"ordinal","domain":{"data":"tree","field":"name"},"range":{"scheme":"tableau20"}},{"name":"xscale","zero":false,"domain":{"signal":"xdom"},"range":{"signal":"xrange"}},{"name":"yscale","zero":false,"domain":{"signal":"ydom"},"range":{"signal":"yrange"}}],"title":"flame","portal-opts":[{"signal":"definition","command":"example.core/goto-definition"},{"signal":"args","command":"cyrik.omni-trace/re-run"}],"padding":30,"marks":[{"type":"rect","from":{"data":"filter-tree"},"encode":{"enter":{"tooltip":{"signal":"{name: datum.name,\n         args: datum.args,\n         throw: datum.thrown,\n         return: datum.return}"}},"update":{"x":{"scale":"xscale","field":"a0"},"x2":{"scale":"xscale","field":"a1"},"y":{"scale":"yscale","field":"r0"},"y2":{"scale":"yscale","field":"r1"},"fill":{"scale":"color","field":"name"},"stroke":{"value":"white"},"strokeWidth":{"value":0.1}},"hover":{"stroke":{"value":"red"},"strokeWidth":{"value":2},"zindex":{"value":1}}}},{"type":"text","from":{"data":"filter-tree"},"interactive":false,"encode":{"enter":{"font":{"value":"Helvetica Neue, Arial"},"align":{"value":"center"},"baseline":{"value":"middle"},"fill":{"value":"white"},"text":{"field":"name"}},"update":{"fontSize":{"signal":"size * 3.0 * (datum.a1 - datum.a0)"},"x":{"scale":"xscale","signal":"0.5 * (datum.a0 + datum.a1)"},"y":{"scale":"yscale","signal":"0.5 * (datum.r0 + datum.r1)"}}}}],"$schema":"https://vega.github.io/schema/vega/v5.json","signals":[{"name":"clicked","value":null,"on":[{"events":"click","update":"datum ? {value: datum.id, depth: datum.depth} : null","force":true}]},{"name":"clear","value":true,"on":[{"events":"mouseup[!event.item]","update":"true","force":true}]},{"name":"shift","value":false,"on":[{"events":"click","update":"event.shiftKey","force":true}]},{"name":"over","on":[{"events":"mouseover","source":"window","force":true,"update":"datum ? datum : null"}],"value":false},{"name":"key","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'a'"},"update":"over ? over : null"}]},{"name":"copy","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? over.name : null"}]},{"name":"definition","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'd'"},"update":"over ? over.meta : null"}]},{"name":"args","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? {traceid: over.id, args:over.args} : null"}]},{"name":"xdom","update":"slice(xext)","on":[{"events":{"signal":"delta"},"update":"[xcur[0] + span(xcur) * delta[0] / width, xcur[1] + span(xcur) * delta[0] / width]"},{"events":{"signal":"zoom"},"update":"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{"name":"ydom","update":"slice(yext)","on":[{"events":{"signal":"delta"},"update":"[ycur[0] + span(ycur) * delta[1] / height, ycur[1] + span(ycur) * delta[1] / height]"},{"events":{"signal":"zoom"},"update":"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]},{"name":"size","update":"clamp(20 / span(xdom), 0.01, 1000)"},{"name":"xext","update":"[0, width]"},{"name":"yext","update":"[height, 0]"},{"name":"xcur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(xdom)"}]},{"name":"ycur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(ydom)"}]},{"name":"delta","value":[0,0],"on":[{"events":[{"source":"window","type":"mousemove","consume":true,"between":[{"type":"mousedown"},{"source":"window","type":"mouseup"}]},{"type":"touchmove","consume":true,"filter":"event.touches.length === 1"}],"update":"down ? [down[0]-x(), y()-down[1]] : [0,0]"}]},{"name":"anchor","value":[0,0],"on":[{"events":"wheel","update":"[width / 2, height /2]"},{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"[width / 2, height /2]"}]},{"name":"zoom","value":1,"on":[{"events":"wheel!","force":true,"update":"pow(1.001, event.deltaY * pow(16, event.deltaMode))"},{"events":{"signal":"dist2"},"force":true,"update":"dist1 / dist2"}]},{"name":"down","value":null,"on":[{"events":"touchend","update":"null"},{"events":"mousedown, touchstart","update":"xy()"}]},{"name":"dist1","value":0,"on":[{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"pinchDistance(event)"},{"events":{"signal":"dist2"},"update":"dist2"}]},{"name":"dist2","value":0,"on":[{"events":{"type":"touchmove","consume":true,"filter":"event.touches.length===2"},"update":"pinchDistance(event)"}]},{"name":"xrange","update":"[0, width]"},{"name":"yrange","update":"[height,0]"}],"height":500,"data":[{"name":"selected","on":[{"trigger":"clear","remove":true},{"trigger":"!shift","remove":true},{"trigger":"!shift && clicked","insert":"clicked"},{"trigger":"shift && clicked","toggle":"clicked"}]},{"name":"tree","values":[{"args":[[200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],0],"meta":{"arglists":[["acc","val"]],"line":74,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner3","ns":null},"parent":"68301","name":"advent.day1/runner3","start":1638899332808,"inner":[],"id":"68302","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":[["clojure.lang.RT","seqFrom","RT.java",557],["clojure.lang.RT","seq","RT.java",537],["clojure.core$seq__5419","invokeStatic","core.clj",139],["clojure.core$apply","invokeStatic","core.clj",662],["clojure.core$apply","invoke","core.clj",662],["advent.day1$runner3","invokeStatic","day1.clj",74],["advent.day1$runner3","invoke","day1.clj",74],["clojure.lang.AFn","applyToHelper","AFn.java",156],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",92],["clojure.lang.PersistentVector","reduce","PersistentVector.java",343],["clojure.core$reduce","invokeStatic","core.clj",6829],["clojure.core$reduce","invoke","core.clj",6812],["advent.day1$count_increases5","invokeStatic","day1.clj",79],["advent.day1$count_increases5","invoke","day1.clj",78],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",90],["advent.day1$run5","invokeStatic","day1.clj",83],["advent.day1$run5","invoke","day1.clj",83],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",88],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.deep_trace$run_traced$fn__18188","invoke","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","invokeStatic","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","doInvoke","deep_trace.clj",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.lang.Var","applyTo","Var.java",705],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace$run_traced","invokeStatic","omni_trace.cljc",67],["cyrik.omni_trace$run_traced","doInvoke","omni_trace.cljc",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["oz.day1$eval68071","invokeStatic","NO_SOURCE_FILE",0],["oz.day1$eval68071","invoke","NO_SOURCE_FILE",-1],["clojure.lang.Compiler","eval","Compiler.java",7181],["clojure.lang.Compiler","eval","Compiler.java",7136],["clojure.core$eval","invokeStatic","core.clj",3202],["clojure.core$eval","invoke","core.clj",3198],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417","invoke","next.clj",899],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416","invoke","next.clj",898],["oz.next$evaluate_block_BANG_$fn__65402","invoke","next.clj",897],["clojure.core.async$thread_call$fn__45672","invoke","async.clj",484],["clojure.lang.AFn","run","AFn.java",22],["java.util.concurrent.ThreadPoolExecutor","runWorker","ThreadPoolExecutor.java",1136],["java.util.concurrent.ThreadPoolExecutor$Worker","run","ThreadPoolExecutor.java",635],["java.lang.Thread","run","Thread.java",833]],"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638899332809},{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"arglists":[["input"]],"line":78,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"count-increases5","ns":null},"parent":"68300","name":"advent.day1/count-increases5","start":1638899332807,"inner":[],"id":"68301","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":[["clojure.lang.RT","seqFrom","RT.java",557],["clojure.lang.RT","seq","RT.java",537],["clojure.core$seq__5419","invokeStatic","core.clj",139],["clojure.core$apply","invokeStatic","core.clj",662],["clojure.core$apply","invoke","core.clj",662],["advent.day1$runner3","invokeStatic","day1.clj",74],["advent.day1$runner3","invoke","day1.clj",74],["clojure.lang.AFn","applyToHelper","AFn.java",156],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",92],["clojure.lang.PersistentVector","reduce","PersistentVector.java",343],["clojure.core$reduce","invokeStatic","core.clj",6829],["clojure.core$reduce","invoke","core.clj",6812],["advent.day1$count_increases5","invokeStatic","day1.clj",79],["advent.day1$count_increases5","invoke","day1.clj",78],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",90],["advent.day1$run5","invokeStatic","day1.clj",83],["advent.day1$run5","invoke","day1.clj",83],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",88],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.deep_trace$run_traced$fn__18188","invoke","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","invokeStatic","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","doInvoke","deep_trace.clj",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.lang.Var","applyTo","Var.java",705],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace$run_traced","invokeStatic","omni_trace.cljc",67],["cyrik.omni_trace$run_traced","doInvoke","omni_trace.cljc",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["oz.day1$eval68071","invokeStatic","NO_SOURCE_FILE",0],["oz.day1$eval68071","invoke","NO_SOURCE_FILE",-1],["clojure.lang.Compiler","eval","Compiler.java",7181],["clojure.lang.Compiler","eval","Compiler.java",7136],["clojure.core$eval","invokeStatic","core.clj",3202],["clojure.core$eval","invoke","core.clj",3198],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417","invoke","next.clj",899],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416","invoke","next.clj",898],["oz.next$evaluate_block_BANG_$fn__65402","invoke","next.clj",897],["clojure.core.async$thread_call$fn__45672","invoke","async.clj",484],["clojure.lang.AFn","run","AFn.java",22],["java.util.concurrent.ThreadPoolExecutor","runWorker","ThreadPoolExecutor.java",1136],["java.util.concurrent.ThreadPoolExecutor$Worker","run","ThreadPoolExecutor.java",635],["java.lang.Thread","run","Thread.java",833]],"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638899332809},{"args":[],"meta":{"arglists":[[]],"line":83,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"run5","ns":null},"parent":null,"name":"advent.day1/run5","start":1638899332807,"inner":[],"id":"68300","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":[["clojure.lang.RT","seqFrom","RT.java",557],["clojure.lang.RT","seq","RT.java",537],["clojure.core$seq__5419","invokeStatic","core.clj",139],["clojure.core$apply","invokeStatic","core.clj",662],["clojure.core$apply","invoke","core.clj",662],["advent.day1$runner3","invokeStatic","day1.clj",74],["advent.day1$runner3","invoke","day1.clj",74],["clojure.lang.AFn","applyToHelper","AFn.java",156],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",92],["clojure.lang.PersistentVector","reduce","PersistentVector.java",343],["clojure.core$reduce","invokeStatic","core.clj",6829],["clojure.core$reduce","invoke","core.clj",6812],["advent.day1$count_increases5","invokeStatic","day1.clj",79],["advent.day1$count_increases5","invoke","day1.clj",78],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",90],["advent.day1$run5","invokeStatic","day1.clj",83],["advent.day1$run5","invoke","day1.clj",83],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.AFn","applyTo","AFn.java",144],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.instrument$trace_fn_call$fn__17843","invoke","instrument.cljc",51],["cyrik.omni_trace.instrument$trace_fn_call","invokeStatic","instrument.cljc",49],["cyrik.omni_trace.instrument$trace_fn_call","invoke","instrument.cljc",40],["cyrik.omni_trace.instrument$instrumented$instrumented__17851","invoke","instrument.cljc",88],["clojure.lang.AFn","applyToHelper","AFn.java",152],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace.deep_trace$run_traced$fn__18188","invoke","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","invokeStatic","deep_trace.clj",72],["cyrik.omni_trace.deep_trace$run_traced","doInvoke","deep_trace.clj",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["clojure.lang.AFn","applyToHelper","AFn.java",154],["clojure.lang.RestFn","applyTo","RestFn.java",132],["clojure.lang.Var","applyTo","Var.java",705],["clojure.core$apply","invokeStatic","core.clj",667],["clojure.core$apply","invoke","core.clj",662],["cyrik.omni_trace$run_traced","invokeStatic","omni_trace.cljc",67],["cyrik.omni_trace$run_traced","doInvoke","omni_trace.cljc",66],["clojure.lang.RestFn","invoke","RestFn.java",410],["oz.day1$eval68071","invokeStatic","NO_SOURCE_FILE",0],["oz.day1$eval68071","invoke","NO_SOURCE_FILE",-1],["clojure.lang.Compiler","eval","Compiler.java",7181],["clojure.lang.Compiler","eval","Compiler.java",7136],["clojure.core$eval","invokeStatic","core.clj",3202],["clojure.core$eval","invoke","core.clj",3198],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417","invoke","next.clj",899],["oz.next$evaluate_block_BANG_$fn__65402$fn__65416","invoke","next.clj",898],["oz.next$evaluate_block_BANG_$fn__65402","invoke","next.clj",897],["clojure.core.async$thread_call$fn__45672","invoke","async.clj",484],["clojure.lang.AFn","run","AFn.java",22],["java.util.concurrent.ThreadPoolExecutor","runWorker","ThreadPoolExecutor.java",1136],["java.util.concurrent.ThreadPoolExecutor$Worker","run","ThreadPoolExecutor.java",635],["java.lang.Thread","run","Thread.java",833]],"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638899332809}],"transform":[{"type":"stratify","key":"id","parentKey":"parent"}]},{"name":"tree-ancestors","source":"tree","transform":[{"type":"formula","expr":"treeAncestors('tree', datum.id, 'root')","as":"treeAncestors"}]},{"name":"tree-ancestors-flatt","source":"tree-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"selected-ancestors","source":"tree-ancestors","transform":[{"type":"filter","expr":"indata('selected', 'value', datum.id)"}]},{"name":"selected-ancestors-flat","source":"selected-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"filtered","source":"tree-ancestors-flatt","transform":[{"type":"filter","expr":"!length(data('selected')) || datum.parent == null || indata('selected', 'value', datum.treeAncestors.id)"}]},{"name":"filtered-aggregate","source":"filtered","transform":[{"type":"aggregate","groupby":["id"]}]},{"name":"filtered-tree","source":"tree","transform":[{"type":"filter","expr":"!length(data('selected'))|| indata('filtered-aggregate', 'id', datum.id) || indata('selected-ancestors-flat', 'treeAncestors.id', datum.id)"}]},{"name":"filter-tree","source":"filtered-tree","transform":[{"key":"id","parentKey":"parent","type":"stratify"},{"as":["a0","r0","a1","r1","depth","children"],"type":"partition","size":[{"signal":"width"},{"signal":"height"}],"padding":2,"sort":{"field":"id"}}]}]}, {"mode":"vega"});</script></div></div><p>It seems we called runner with the wrong inputs. Wouldn't it be great to see what reduce got as inputs to know what happened?</p><p>Let's take off the security breaks:</p><pre><code class="clj">(defn run6 [] (count-increases5 depths))</code></pre><div><pre><code class="clj">[:pprint (reset! cyrik.omni-trace.instrument/ns-blacklist [])]</code></pre><pre>[]
</pre></div><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run6)]</code></pre><pre>{:via
 [{:type java.lang.NullPointerException,
   :message
   "Cannot invoke \"java.util.concurrent.Future.get()\" because \"fut\" is null",
   :at [clojure.core$deref_future invokeStatic "core.clj" 2304]}],
 :trace
 [[clojure.core$deref_future invokeStatic "core.clj" 2304]
  [clojure.core$deref invokeStatic "core.clj" 2324]
  [clojure.core$deref invoke "core.clj" 2310]
  [cyrik.omni_trace.deep_trace$run_traced$fn__18188
   invoke
   "deep_trace.clj"
   72]
  [cyrik.omni_trace.deep_trace$run_traced
   invokeStatic
   "deep_trace.clj"
   72]
  [cyrik.omni_trace.deep_trace$run_traced doInvoke "deep_trace.clj" 66]
  [clojure.lang.RestFn invoke "RestFn.java" 410]
  [clojure.lang.AFn applyToHelper "AFn.java" 154]
  [clojure.lang.RestFn applyTo "RestFn.java" 132]
  [clojure.lang.Var applyTo "Var.java" 705]
  [clojure.core$apply invokeStatic "core.clj" 667]
  [clojure.core$apply invoke "core.clj" 662]
  [cyrik.omni_trace$run_traced invokeStatic "omni_trace.cljc" 67]
  [cyrik.omni_trace$run_traced doInvoke "omni_trace.cljc" 66]
  [clojure.lang.RestFn invoke "RestFn.java" 410]
  [oz.day1$eval68737 invokeStatic "NO_SOURCE_FILE" 0]
  [oz.day1$eval68737 invoke "NO_SOURCE_FILE" -1]
  [clojure.lang.Compiler eval "Compiler.java" 7181]
  [clojure.lang.Compiler eval "Compiler.java" 7136]
  [clojure.core$eval invokeStatic "core.clj" 3202]
  [clojure.core$eval invoke "core.clj" 3198]
  [oz.next$evaluate_block_BANG_$fn__65402$fn__65416$fn__65417
   invoke
   "next.clj"
   899]
  [oz.next$evaluate_block_BANG_$fn__65402$fn__65416
   invoke
   "next.clj"
   898]
  [oz.next$evaluate_block_BANG_$fn__65402 invoke "next.clj" 897]
  [clojure.core.async$thread_call$fn__45672 invoke "async.clj" 484]
  [clojure.lang.AFn run "AFn.java" 22]
  [java.util.concurrent.ThreadPoolExecutor
   runWorker
   "ThreadPoolExecutor.java"
   1136]
  [java.util.concurrent.ThreadPoolExecutor$Worker
   run
   "ThreadPoolExecutor.java"
   635]
  [java.lang.Thread run "Thread.java" 833]],
 :cause
 "Cannot invoke \"java.util.concurrent.Future.get()\" because \"fut\" is null"}
</pre></div><pre><code class="clj">(reset! cyrik.omni-trace.instrument/ns-blacklist ['cljs.core 'clojure.core])</code></pre><div><pre><code class="clj">[:vega (assoc (cyrik.omni-trace/rooted-flamegraph 'advent.day1/run6) :width 1200 :height 690)]</code></pre><div><div id="viz-ffebed9f-6970-40bc-9135-1b33cd3a87e4"><img alt="compiled vega png" src="data:image/png;base64," /></div><script type="text/javascript">vegaEmbed('#viz-ffebed9f-6970-40bc-9135-1b33cd3a87e4', {"width":1200,"scales":[{"name":"color","type":"ordinal","domain":{"data":"tree","field":"name"},"range":{"scheme":"tableau20"}},{"name":"xscale","zero":false,"domain":{"signal":"xdom"},"range":{"signal":"xrange"}},{"name":"yscale","zero":false,"domain":{"signal":"ydom"},"range":{"signal":"yrange"}}],"title":"flame","portal-opts":[{"signal":"definition","command":"example.core/goto-definition"},{"signal":"args","command":"cyrik.omni-trace/re-run"}],"padding":30,"marks":[{"type":"rect","from":{"data":"filter-tree"},"encode":{"enter":{"tooltip":{"signal":"{name: datum.name,\n         args: datum.args,\n         throw: datum.thrown,\n         return: datum.return}"}},"update":{"x":{"scale":"xscale","field":"a0"},"x2":{"scale":"xscale","field":"a1"},"y":{"scale":"yscale","field":"r0"},"y2":{"scale":"yscale","field":"r1"},"fill":{"scale":"color","field":"name"},"stroke":{"value":"white"},"strokeWidth":{"value":0.1}},"hover":{"stroke":{"value":"red"},"strokeWidth":{"value":2},"zindex":{"value":1}}}},{"type":"text","from":{"data":"filter-tree"},"interactive":false,"encode":{"enter":{"font":{"value":"Helvetica Neue, Arial"},"align":{"value":"center"},"baseline":{"value":"middle"},"fill":{"value":"white"},"text":{"field":"name"}},"update":{"fontSize":{"signal":"size * 3.0 * (datum.a1 - datum.a0)"},"x":{"scale":"xscale","signal":"0.5 * (datum.a0 + datum.a1)"},"y":{"scale":"yscale","signal":"0.5 * (datum.r0 + datum.r1)"}}}}],"$schema":"https://vega.github.io/schema/vega/v5.json","signals":[{"name":"clicked","value":null,"on":[{"events":"click","update":"datum ? {value: datum.id, depth: datum.depth} : null","force":true}]},{"name":"clear","value":true,"on":[{"events":"mouseup[!event.item]","update":"true","force":true}]},{"name":"shift","value":false,"on":[{"events":"click","update":"event.shiftKey","force":true}]},{"name":"over","on":[{"events":"mouseover","source":"window","force":true,"update":"datum ? datum : null"}],"value":false},{"name":"key","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'a'"},"update":"over ? over : null"}]},{"name":"copy","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? over.name : null"}]},{"name":"definition","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'd'"},"update":"over ? over.meta : null"}]},{"name":"args","on":[{"events":{"type":"keydown","force":true,"source":"window","filter":"event.key === 'c'"},"update":"over ? {traceid: over.id, args:over.args} : null"}]},{"name":"xdom","update":"slice(xext)","on":[{"events":{"signal":"delta"},"update":"[xcur[0] + span(xcur) * delta[0] / width, xcur[1] + span(xcur) * delta[0] / width]"},{"events":{"signal":"zoom"},"update":"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{"name":"ydom","update":"slice(yext)","on":[{"events":{"signal":"delta"},"update":"[ycur[0] + span(ycur) * delta[1] / height, ycur[1] + span(ycur) * delta[1] / height]"},{"events":{"signal":"zoom"},"update":"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]},{"name":"size","update":"clamp(20 / span(xdom), 0.01, 1000)"},{"name":"xext","update":"[0, width]"},{"name":"yext","update":"[height, 0]"},{"name":"xcur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(xdom)"}]},{"name":"ycur","value":null,"on":[{"events":"mousedown, touchstart, touchend","update":"slice(ydom)"}]},{"name":"delta","value":[0,0],"on":[{"events":[{"source":"window","type":"mousemove","consume":true,"between":[{"type":"mousedown"},{"source":"window","type":"mouseup"}]},{"type":"touchmove","consume":true,"filter":"event.touches.length === 1"}],"update":"down ? [down[0]-x(), y()-down[1]] : [0,0]"}]},{"name":"anchor","value":[0,0],"on":[{"events":"wheel","update":"[width / 2, height /2]"},{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"[width / 2, height /2]"}]},{"name":"zoom","value":1,"on":[{"events":"wheel!","force":true,"update":"pow(1.001, event.deltaY * pow(16, event.deltaMode))"},{"events":{"signal":"dist2"},"force":true,"update":"dist1 / dist2"}]},{"name":"down","value":null,"on":[{"events":"touchend","update":"null"},{"events":"mousedown, touchstart","update":"xy()"}]},{"name":"dist1","value":0,"on":[{"events":{"type":"touchstart","filter":"event.touches.length===2"},"update":"pinchDistance(event)"},{"events":{"signal":"dist2"},"update":"dist2"}]},{"name":"dist2","value":0,"on":[{"events":{"type":"touchmove","consume":true,"filter":"event.touches.length===2"},"update":"pinchDistance(event)"}]},{"name":"xrange","update":"[0, width]"},{"name":"yrange","update":"[height,0]"}],"height":690,"data":[{"name":"selected","on":[{"trigger":"clear","remove":true},{"trigger":"!shift","remove":true},{"trigger":"!shift && clicked","insert":"clicked"},{"trigger":"shift && clicked","toggle":"clicked"}]},{"name":"tree","values":[{"args":[1,[199,200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"drop","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":2913,"tag":null,"arglists":[["n"],["n","coll"]],"doc":"Returns a lazy sequence of all but the first n items in coll.\n  Returns a stateful transducer when no collection is provided."},"parent":"69496","return":[200,208,210,200,207,240,269,260,263],"name":"clojure.core/drop","start":1638900143535,"inner":[],"id":"69497","thrown":{"trace":null},"end":1638900143535},{"args":[],"meta":{"arglists":[[]],"line":84,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"run6","ns":null,"tag":null},"parent":null,"name":"advent.day1/run6","start":1638900143535,"inner":[],"id":"69495","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":null,"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638900143536},{"args":[[200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],0],"meta":{"arglists":[["acc","val"]],"line":74,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"runner3","ns":null,"tag":null},"parent":"69512","name":"advent.day1/runner3","start":1638900143536,"inner":[],"id":"69513","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":null,"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638900143536},{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"arglists":[["input"]],"line":78,"column":1,"file":"/Users/lukas/Workspace/clojure/omni-trace/dev/advent/day1.clj","name":"count-increases5","ns":null,"tag":null},"parent":"69495","name":"advent.day1/count-increases5","start":1638900143535,"inner":[],"id":"69496","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":null,"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638900143536},{"args":[[200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69500","return":[208,210,200,207,240,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69502","thrown":{"trace":null},"end":1638900143536},{"args":[1,[199,200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"drop","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":2913,"tag":null,"arglists":[["n"],["n","coll"]],"doc":"Returns a lazy sequence of all but the first n items in coll.\n  Returns a stateful transducer when no collection is provided."},"parent":"69496","return":[200,208,210,200,207,240,269,260,263],"name":"clojure.core/drop","start":1638900143536,"inner":[],"id":"69505","thrown":{"trace":null},"end":1638900143536},{"args":[[199,200,208,210,200,207,240,269,260,263],[200,208,210,200,207,240,269,260,263],[208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"interleave","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":4297,"tag":null,"arglists":[[],["c1"],["c1","c2"],["c1","c2","&","colls"]],"doc":"Returns a lazy seq of the first item in each coll, then the second etc."},"parent":"69496","return":[199,200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],"name":"clojure.core/interleave","start":1638900143536,"inner":[],"id":"69499","thrown":{"trace":null},"end":1638900143536},{"args":[[199,200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69496","return":[200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69500","thrown":{"trace":null},"end":1638900143536},{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69496","return":[200,208,210,200,207,240,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69508","thrown":{"trace":null},"end":1638900143536},{"args":[2,[199,200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"drop","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":2913,"tag":null,"arglists":[["n"],["n","coll"]],"doc":"Returns a lazy sequence of all but the first n items in coll.\n  Returns a stateful transducer when no collection is provided."},"parent":"69496","return":[208,210,200,207,240,269,260,263],"name":"clojure.core/drop","start":1638900143536,"inner":[],"id":"69506","thrown":{"trace":null},"end":1638900143536},{"args":[[199,200,208,210,200,207,240,269,260,263],[200,208,210,200,207,240,269,260,263],[208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"interleave","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":4297,"tag":null,"arglists":[[],["c1"],["c1","c2"],["c1","c2","&","colls"]],"doc":"Returns a lazy seq of the first item in each coll, then the second etc."},"parent":"69496","return":[199,200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],"name":"clojure.core/interleave","start":1638900143536,"inner":[],"id":"69507","thrown":{"trace":null},"end":1638900143536},{"args":["cyrik.omni_trace.instrument$instrumented$instrumented__17851@384a8568",[200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],[0,199]],"meta":{"added":"1.0","ns":null,"name":"reduce","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","column":1,"line":6812,"tag":null,"arglists":[["f","coll"],["f","val","coll"]],"doc":"f should be a function of 2 arguments. If val is not supplied,\n  returns the result of applying f to the first 2 items in coll, then\n  applying f to that result and the 3rd item, etc. If coll contains no\n  items, f must accept no arguments as well, and reduce returns the\n  result of calling f with no arguments.  If coll has only 1 item, it\n  is returned and f is not called.  If val is supplied, returns the\n  result of applying f to val and the first item in coll, then\n  applying f to that result and the 2nd item, etc. If coll contains no\n  items, returns val and f is not called."},"parent":"69496","name":"clojure.core/reduce","start":1638900143536,"inner":[],"id":"69512","thrown":{"via":[{"type":"java.lang.IllegalArgumentException","message":"Don't know how to create ISeq from: java.lang.Long","at":["clojure.lang.RT","seqFrom","RT.java",557]}],"trace":null,"cause":"Don't know how to create ISeq from: java.lang.Long"},"end":1638900143536},{"args":[[200,208,210,200,207,240,269,260,263],[208,210,200,207,240,269,260,263],[210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"interleave","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":4297,"tag":null,"arglists":[[],["c1"],["c1","c2"],["c1","c2","&","colls"]],"doc":"Returns a lazy seq of the first item in each coll, then the second etc."},"parent":"69496","return":[200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],"name":"clojure.core/interleave","start":1638900143536,"inner":[],"id":"69511","thrown":{"trace":null},"end":1638900143536},{"args":[2,[199,200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"drop","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":2913,"tag":null,"arglists":[["n"],["n","coll"]],"doc":"Returns a lazy sequence of all but the first n items in coll.\n  Returns a stateful transducer when no collection is provided."},"parent":"69496","return":[208,210,200,207,240,269,260,263],"name":"clojure.core/drop","start":1638900143535,"inner":[],"id":"69498","thrown":{"trace":null},"end":1638900143535},{"args":[[208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69496","return":[210,200,207,240,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69510","thrown":{"trace":null},"end":1638900143536},{"args":[[199,200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69500","return":[200,208,210,200,207,240,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69501","thrown":{"trace":null},"end":1638900143536},{"args":[[200,208,200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"second","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":93,"tag":null,"arglists":[["x"]],"doc":"Same as (first (next x))"},"parent":"69513","return":208,"name":"clojure.core/second","start":1638900143536,"inner":[],"id":"69514","thrown":{"trace":null},"end":1638900143536},{"args":[[200,208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69496","return":[208,210,200,207,240,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69509","thrown":{"trace":null},"end":1638900143536},{"args":[[208,210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"rest","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":66,"tag":null,"arglists":[["coll"]],"doc":"Returns a possibly empty seq of the items after the first. Calls seq on its\n  argument."},"parent":"69500","return":[210,200,207,240,269,260,263],"name":"clojure.core/rest","start":1638900143536,"inner":[],"id":"69503","thrown":{"trace":null},"end":1638900143536},{"args":[[200,208,210,200,207,240,269,260,263],[208,210,200,207,240,269,260,263],[210,200,207,240,269,260,263]],"meta":{"added":"1.0","ns":null,"name":"interleave","file":"file:/Users/lukas/.m2/repository/org/clojure/clojure/1.10.3/clojure-1.10.3.jar!/clojure/core.clj","static":true,"column":1,"line":4297,"tag":null,"arglists":[[],["c1"],["c1","c2"],["c1","c2","&","colls"]],"doc":"Returns a lazy seq of the first item in each coll, then the second etc."},"parent":"69500","return":[200,208,210,208,210,200,210,200,207,200,207,240,207,240,269,240,269,260,269,260,263],"name":"clojure.core/interleave","start":1638900143536,"inner":[],"id":"69504","thrown":{"trace":null},"end":1638900143536}],"transform":[{"type":"stratify","key":"id","parentKey":"parent"}]},{"name":"tree-ancestors","source":"tree","transform":[{"type":"formula","expr":"treeAncestors('tree', datum.id, 'root')","as":"treeAncestors"}]},{"name":"tree-ancestors-flatt","source":"tree-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"selected-ancestors","source":"tree-ancestors","transform":[{"type":"filter","expr":"indata('selected', 'value', datum.id)"}]},{"name":"selected-ancestors-flat","source":"selected-ancestors","transform":[{"type":"flatten","fields":["treeAncestors"]}]},{"name":"filtered","source":"tree-ancestors-flatt","transform":[{"type":"filter","expr":"!length(data('selected')) || datum.parent == null || indata('selected', 'value', datum.treeAncestors.id)"}]},{"name":"filtered-aggregate","source":"filtered","transform":[{"type":"aggregate","groupby":["id"]}]},{"name":"filtered-tree","source":"tree","transform":[{"type":"filter","expr":"!length(data('selected'))|| indata('filtered-aggregate', 'id', datum.id) || indata('selected-ancestors-flat', 'treeAncestors.id', datum.id)"}]},{"name":"filter-tree","source":"filtered-tree","transform":[{"key":"id","parentKey":"parent","type":"stratify"},{"as":["a0","r0","a1","r1","depth","children"],"type":"partition","size":[{"signal":"width"},{"signal":"height"}],"padding":2,"sort":{"field":"id"}}]}]}, {"mode":"vega"});</script></div></div><p><b><i> interesting interlude: the traces show how lazily some of clojure's seq functions work </i></b></p><p>Oh! I called the final partition with the first element instead of calling first on partition! easy fix: </p><pre><code class="clj">(defn count-increases6 [input]
  (reduce runner3
          (partition 3 (rest (interleave input (drop 1 input) (drop 2 input))))
          [0 (first (partition 3 (interleave input (drop 1 input) (drop 2 input))))]))</code></pre><p>Ah switched around again, this time i see it! (plus the indexes are matching again ...)</p><pre><code class="clj">(defn count-increases7 [input]
  (reduce runner3
          [0 (first (partition 3 (interleave input (drop 1 input) (drop 2 input))))]
          (partition 3 (rest (interleave input (drop 1 input) (drop 2 input))))))</code></pre><pre><code class="clj">(defn run7 [] (count-increases7 depths))</code></pre><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run7)]</code></pre><pre>[5 (269 260 269)]
</pre></div><p>I got that working as well, finally.</p><p>Although it does look a little ugly, let's clean it up by using the step version of partition and not running it twice:</p><pre><code class="clj">(defn count-increases-final [input]
    (let [windowed (partition 3 1 input)]
      (reduce runner3
              [0 (first windowed)]
              (rest windowed))))</code></pre><pre><code class="clj">(defn run-final [] (count-increases-final depths))</code></pre><div><pre><code class="clj">[:pprint (cyrik.omni-trace/run-traced 'advent.day1/run-final)]</code></pre><pre>[5 (269 260 263)]
</pre></div></div></body></html>